{% extends 'projects/_base.html' %}

{% set active_tab = 'settings' %}

{% block content %}
  <h3>Hooks</h3>

  {% if project.hooks.first() %}
    <div class="list-group">
      {% for hook in project.hooks %}
        <div class="list-group-item">
          <h4>{{ hook.title }}</h4>
          <pre>{{ hook.build_script }}</pre>
          
          <a class="btn btn-default" id="edit-hook-{{ hook.id }}"
             href="{{ url_for('.edit_hook', project_id=project.id,
                              hook_id=hook.id) }}">
            <span class="glyphicon glyphicon-edit"></span> Edit
          </a>
          
          <form method="POST" style="display: inline;"
                action="{{ url_for('.delete_hook', project_id=project.id, hook_id=hook.id) }}"
                id="delete-hook-{{ hook.id }}">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
            <button type="submit" class="btn btn-default">
              <span class="glyphicon glyphicon-remove-sign"></span> Delete
            </button>
          </form>
        </div>
      {% endfor %}
    </div> 
  {% else %}
    <p>Hooks haven't been configured yet.</p>
  {% endif %}

  <a href="{{ url_for('.add_hook', project_id=project.id) }}" class="btn btn-default">
    <span class="glyphicon glyphicon-plus-sign"></span>
    Add a new hook
  </a>
  
  <hr>

  <h3>Members</h3>

  <div class="list-group  members">
    {% for member in [project.owner] + project.members.all() %}
    <div class="list-group-item  member {% if member == project.owner %}owner{% endif %}">
        <img src="{{ member.gh_avatar_url }}" height="38" class="img-circle">
        {{ member.gh_login }} {% if member == project.owner %}(owner){% endif %}

        {% if member != project.owner %} 
          <form id="delete-member-{{ member.id }}" method="POST" class="pull-right"
                action="{{ url_for('.delete_member', project_id=project.id,
                                   user_id=member.id) }}">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
            <button type="submit" class="btn btn-default">
              <span class="glyphicon glyphicon-remove-sign"></span> Delete
            </button>
          </form>
        {% endif %}
      </div>
    {% endfor %}
  </div> 

  <a href="{{ url_for('.add_member', project_id=project.id) }}" class="btn btn-default">
    <span class="glyphicon glyphicon-plus-sign"></span>
    Add a new member
  </a>
{% endblock %}
